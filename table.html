<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>シンプルなHTMLテンプレート</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
</head>

<body>
    <h1 class="display-1">Inst Dictionary</h1>
    <div id="preset-container"></div>
    <!-- table -->
    <div class="container-fluid">
        <table id="inst-table" class="table table-bordered table-responsive" aria-label="Sample table for sorting and hiding rows">
            <thead>
                <tr>
                    <th>ID</th>
                    <th class="d-none">order</th>
                    <th>楽器名</th>
                    <th>音域サンプル</th>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>100</td>
                    <td class="d-none">order</td>
                    <td colspan="4" class="text-center" style="background-color: lightgray;">Woodwinds</td>
                    <td class="d-none"></td>
                    <td class="d-none"></td>
                    <td class="d-none"></td>
                </tr>
                <tr>
                    <td>111</td>
                    <td class="d-none">order</td>
                    <td>Piccolo</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>112</td>
                    <td class="d-none">order</td>
                    <td>Flute</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>113</td>
                    <td class="d-none">order</td>
                    <td>Alto Flute in G</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>114</td>
                    <td class="d-none">order</td>
                    <td>Bass Flute</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>121</td>
                    <td class="d-none">order</td>
                    <td>Oboe</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>122</td>
                    <td class="d-none">order</td>
                    <td>Oboe d'amore</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>123</td>
                    <td class="d-none">order</td>
                    <td>English Horn</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>131</td>
                    <td class="d-none">order</td>
                    <td>Clarinet in Eb</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>132</td>
                    <td class="d-none">order</td>
                    <td>Clarinet in Bb</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>133</td>
                    <td class="d-none">order</td>
                    <td>Clarinet in A</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>134</td>
                    <td class="d-none">order</td>
                    <td>Alto Clarinet in Eb</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>135</td>
                    <td class="d-none">order</td>
                    <td>Alto Clarinet in F</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>136</td>
                    <td class="d-none">order</td>
                    <td>Bass Clarinet in Bb</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>137</td>
                    <td class="d-none">order</td>
                    <td>Basset Horn in F</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>141</td>
                    <td class="d-none">order</td>
                    <td>Bassoon</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>142</td>
                    <td class="d-none">order</td>
                    <td>Double Bassoon</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>151</td>
                    <td class="d-none">order</td>
                    <td>Sopranino Saxophone in Eb</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>152</td>
                    <td class="d-none">order</td>
                    <td>Soprano Saxophone in Bb</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>153</td>
                    <td class="d-none">order</td>
                    <td>Alto Saxophone in Eb</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>154</td>
                    <td class="d-none">order</td>
                    <td>Tenor Saxophone in Bb</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>155</td>
                    <td class="d-none">order</td>
                    <td>Baritone Saxophone in Eb</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>156</td>
                    <td class="d-none">order</td>
                    <td>Bass saxophone in Bb</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>

                <tr>
                    <td>200</td>
                    <td class="d-none">order</td>
                    <td colspan="4" class="text-center" style="background-color: lightgray;">Brass</td>
                    <td class="d-none"></td>
                    <td class="d-none"></td>
                    <td class="d-none"></td>
                </tr>
                <tr>
                    <td>211</td>
                    <td class="d-none">order</td>
                    <td>Horn in F</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>221</td>
                    <td class="d-none">order</td>
                    <td>Piccolo Trumpet in C</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>222</td>
                    <td class="d-none">order</td>
                    <td>Piccolo Trumpet in Bb</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>223</td>
                    <td class="d-none">order</td>
                    <td>Piccolo Trumpet in A</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>224</td>
                    <td class="d-none">order</td>
                    <td>Trumpet in C</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>225</td>
                    <td class="d-none">order</td>
                    <td>Trumpet in Bb</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>226</td>
                    <td class="d-none">order</td>
                    <td>Bass Trumpet in C</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>231</td>
                    <td class="d-none">order</td>
                    <td>Trombone</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>232</td>
                    <td class="d-none">order</td>
                    <td>Euphonium</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>233</td>
                    <td class="d-none">order</td>
                    <td>Tuba</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>300</td>
                    <td class="d-none">order</td>

                    <td colspan="4" class="text-center" style="background-color: lightgray;">keyboard</td>
                    <td class="d-none"></td>
                    <td class="d-none"></td>
                    <td class="d-none"></td>
                </tr>
                <tr>
                    <td>311</td>
                    <td class="d-none">order</td>
                    <td>Piano</td>

                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>400</td>
                    <td class="d-none">order</td>
                    <td colspan="4" class="text-center" style="background-color: lightgray;">Strings</td>
                    <td class="d-none"></td>
                    <td class="d-none"></td>
                    <td class="d-none"></td>
                </tr>
                <tr>
                    <td>411</td>
                    <td class="d-none">order</td>
                    <td>Violin</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>412</td>
                    <td class="d-none">order</td>
                    <td>Viola</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>413</td>
                    <td class="d-none">order</td>
                    <td>Violoncello</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>414</td>
                    <td class="d-none">order</td>
                    <td>Contrabass</td>
                    <td><img class='img-fluid' src='https://kogu0507.github.io/RegisterTable/testSVG.svg'
                            alt='sample image'>4列1行</td>
                    <td>ハーモニクスの画像</td>
                    <td>トリルの画像</td>
                </tr>
                <tr>
                    <td>999</td>
                    <td></td>
                    <td colspan="4" class="text-center">You cannot select this preset.</td>
                    <td class="d-none"></td>
                    <td class="d-none"></td>
                    <td class="d-none"></td>
                </tr>
            </tbody>
        </table>
        <h6>TODO:</h6>
        <ul>
            <li>
                さっさとやれ
                <ul>
                    <li>order列非表示</li>
                    <li>音域譜例どする？最適音域を推す</li>
                    <li>音域準の、詳しい順番（今はざっくりわけただけ）</li>
                </ul>
            </li>
            <li>他の列考えろ
                <ul>
                    <li>特殊奏法</li>
                    <li>運指表へのリンク</li>
                </ul>
            </li>
            <li>他のプリセット考えろ
                <ul>
                    <li></li>
                </ul>
            </li>
            <li>
                今後の拡張考えろ
                <ul>
                    <li>プリセット選択後、ユーザーがカスタマイズできる</li>
                    <li>ユーザープリセットのsave,load</li>
                    <li>楽器数増やす（打楽器？ハープ？）</li>
                </ul>
            </li>

        </ul>
    </div>

    <!-- JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="table_data.js"></script>

    <script>
        $(document).ready(function () {
            // DataTableを初期化
            const table = $('#inst-table').DataTable({
                responsive: true,
                paging: false, // ページングを無効化
                info: false    // 情報表示を無効化
            });

            // Select Prisetを生成
            createPresetSelect();

            // TableManager クラス
            class TableManager {
                constructor(table) {
                    this.table = table;
                    this.resetOrderColumn(); // 初期化時にOrder列をリセット
                }

                // Order列をリセット（値を空にする）
                resetOrderColumn() {
                    this.table.rows().every(function () {
                        const rowData = this.data();
                        rowData[ORDER_COLUMN_NUM] = '';  // Order列をクリア
                        this.data(rowData); // 更新したデータを再設定
                    });
                    this.table.draw(); // テーブルを再描画
                }

                // プリセットを適用
                applyPreset(preset) {
                    if (!preset) {
                        // プリセットが選択されていない場合は検索をリセット
                        this.table.search('').draw(); // フィルタをリセット
                        this.table.order([ID_COLUMN_NUM, 'asc']).draw(); // デフォルトの順序でソート
                        return;
                    }

                    // Order列をリセット
                    this.resetOrderColumn();

                    // プリセットに基づいてOrder列に値をセット
                    preset.ids.forEach((id, index) => {
                        const rowIndex = this.findRowByID(id);
                        if (rowIndex !== -1) {
                            // Order列に "Preset:プリセット名-カウント" の形式で設定
                            this.table.cell(rowIndex, ORDER_COLUMN_NUM).data(`Preset:${preset.name}-${(index + 1).toString().padStart(2, '0')}`);
                            //this.table.cell(rowIndex, ORDER_COLUMN_NUM).data(`Preset:${preset.name}-${index + 1}`);
                        } else {
                            // エラー処理: IDが見つからない場合は警告を表示
                            console.warn(`ID '${id}' がテーブル内で見つかりませんでした。`);
                        }
                    });

                    // DataTableの検索ボックスにプリセット名でフィルタを適用
                    this.table.search(`Preset:${preset.name}`).draw();
                    this.table.order([ORDER_COLUMN_NUM, 'asc']).draw(); // Order列でソート
                }

                // IDで行を検索
                findRowByID(id) {
                    let foundRow = null;
                    this.table.rows().every(function () {
                        if (this.data()[ID_COLUMN_NUM] === id) {
                            foundRow = this;
                            return false;  // 見つかったらループを終了
                        }
                    });
                    return foundRow ? foundRow.index() : -1;
                }
            }

            // TableManagerインスタンスを作成
            const tableManager = new TableManager(table);

            // プリセット選択時のイベント
            /*             $('#preset-select').on('change', function () {
                            const presetIndex = $(this).val();
                            const preset = PRESETS[presetIndex];
                            tableManager.applyPreset(preset);
                        });
             */










            // プリセットセレクトボックスを動的に生成する関数
            function createPresetSelect() {
                // preset-container の取得
                const container = document.getElementById('preset-container');

                // セレクトボックスの作成
                const select = document.createElement('select');
                select.id = 'preset-select';  // セレクトボックスにIDを付与
                select.classList.add('form-select');  // クラスを追加

                // デフォルトオプションを追加
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = 'Select Preset';
                select.appendChild(defaultOption);

                // PRESETS配列をもとにオプションを動的に追加
                PRESETS.forEach((preset, index) => {
                    const option = document.createElement('option');
                    option.value = preset.name;  // プリセット名を value に設定
                    option.textContent = preset.name;  // オプションとして表示
                    select.appendChild(option);
                });

                // 作成したセレクトボックスを preset-container に追加
                container.appendChild(select);

                // イベントリスナーを設定
                select.addEventListener('change', handlePresetChange);
            }

            // プリセット変更時のイベント処理関数
            function handlePresetChange() {
                const presetName = this.value;  // 選択されたプリセット名を取得

                // プリセット名に基づいてプリセットを検索
                const preset = PRESETS.find(p => p.name === presetName);

                // プリセットが見つからなかった場合のエラー処理
                if (!preset) {
                    console.error('プリセットが見つかりません:', presetName);
                    return;
                }

                // tableManager が存在しない場合やエラーが発生する場合の処理
                try {
                    if (typeof tableManager !== 'undefined' && typeof tableManager.applyPreset === 'function') {
                        tableManager.applyPreset(preset);  // プリセット適用処理
                    } else {
                        throw new Error('tableManagerまたはapplyPresetが定義されていません');
                    }
                } catch (error) {
                    console.error('エラーが発生しました:', error);
                }
            }

            // ページ読み込み時にセレクトボックスを生成
            //document.addEventListener('DOMContentLoaded', createPresetSelect);

        });

    </script>
</body>

</html>